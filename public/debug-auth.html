<!DOCTYPE html>
<html>
<head>
    <title>Debug Auth</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        p { margin: 5px 0; }
        .section { margin: 20px 0; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <h1>Debug Autenticação</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function log(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        function addSection(title) {
            output.innerHTML += '<div class="section"><h3>' + title + '</h3>';
        }

        function endSection() {
            output.innerHTML += '</div>';
        }

        // Verificar tokens no localStorage
        addSection('VERIFICANDO TOKENS');

        const tokens = [
            'ludomusic_session_token',
            'sessionToken',
            'session_token'
        ];

        tokens.forEach(key => {
            const value = localStorage.getItem(key);
            log(`${key}: ${value ? 'PRESENTE (' + value.substring(0, 20) + '...)' : 'AUSENTE'}`);
        });
        endSection();

        // Verificar todas as chaves do localStorage
        addSection('TODAS AS CHAVES DO LOCALSTORAGE');
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            log(`${key}: ${value ? value.substring(0, 50) + '...' : 'vazio'}`);
        }
        endSection();

        // Testar API de auth
        addSection('TESTANDO API DE AUTH');
        const token = localStorage.getItem('ludomusic_session_token');

        if (token) {
            log('Token encontrado, testando API...');
            fetch(`/api/auth?sessionToken=${token}`)
                .then(response => {
                    log('Status da resposta: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Resposta da API: ' + JSON.stringify(data, null, 2));
                })
                .catch(error => {
                    log('Erro na API: ' + error.message);
                });
        } else {
            log('Nenhum token encontrado para testar');
        }
        endSection();
    </script>
</body>
</html>
