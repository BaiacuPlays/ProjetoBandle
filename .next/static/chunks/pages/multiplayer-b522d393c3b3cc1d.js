(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{5022:function(e,a,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/multiplayer",function(){return o(1842)}])},1842:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return b}});var r=o(5893),t=o(9008),n=o.n(t),s=o(4746),l=o(7294),i=o(5621);let c={roomCode:"",playerNickname:"",lobbyData:null,isLoading:!1,error:"",isConnected:!1,currentScreen:"lobby"},d={SET_ROOM_CODE:"SET_ROOM_CODE",SET_PLAYER_NICKNAME:"SET_PLAYER_NICKNAME",SET_LOBBY_DATA:"SET_LOBBY_DATA",SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",SET_CONNECTED:"SET_CONNECTED",SET_CURRENT_SCREEN:"SET_CURRENT_SCREEN",RESET:"RESET"};function u(e,a){switch(a.type){case d.SET_ROOM_CODE:return{...e,roomCode:a.payload};case d.SET_PLAYER_NICKNAME:return{...e,playerNickname:a.payload};case d.SET_LOBBY_DATA:return{...e,lobbyData:a.payload};case d.SET_LOADING:return{...e,isLoading:a.payload};case d.SET_ERROR:return{...e,error:a.payload};case d.SET_CONNECTED:return{...e,isConnected:a.payload};case d.SET_CURRENT_SCREEN:return{...e,currentScreen:a.payload};case d.RESET:return c;default:return e}}let m=(0,l.createContext)();function p(e){let{children:a}=e,[o,t]=(0,l.useReducer)(u,c);return(0,l.useEffect)(()=>{if(!o.roomCode||!o.isConnected)return;let e=!0,a=0,r=async()=>{if(e)try{let r=await (0,i.Nv)("/api/lobby?roomCode=".concat(o.roomCode),{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!e)return;if(r.ok){let n=await r.json();e&&(n.roomNotFound?++a>=5&&t({type:d.SET_ERROR,payload:"Conex\xe3o perdida com a sala"}):(t({type:d.SET_LOBBY_DATA,payload:n}),a=0,o.error&&t({type:d.SET_ERROR,payload:""})))}else++a>=10&&e&&t({type:d.SET_ERROR,payload:"Problemas de conex\xe3o com o servidor"})}catch(o){++a>=5&&e&&t({type:d.SET_ERROR,payload:"Problemas de conex\xe3o"})}},n=setTimeout(r,500),s=setInterval(r,4e3);return()=>{e=!1,clearTimeout(n),clearInterval(s)}},[o.roomCode,o.isConnected]),(0,r.jsx)(m.Provider,{value:{state:o,actions:{setRoomCode:e=>t({type:d.SET_ROOM_CODE,payload:e}),setPlayerNickname:e=>t({type:d.SET_PLAYER_NICKNAME,payload:e}),setLobbyData:e=>t({type:d.SET_LOBBY_DATA,payload:e}),setLoading:e=>t({type:d.SET_LOADING,payload:e}),setError:e=>t({type:d.SET_ERROR,payload:e}),setConnected:e=>t({type:d.SET_CONNECTED,payload:e}),setCurrentScreen:e=>t({type:d.SET_CURRENT_SCREEN,payload:e}),reset:()=>t({type:d.RESET}),createRoom:async e=>{t({type:d.SET_LOADING,payload:!0}),t({type:d.SET_ERROR,payload:""});try{let a=await (0,i.Nv)("/api/lobby",{method:"POST",body:JSON.stringify({nickname:e})});if(a.ok){let o=await a.json();console.log("\uD83D\uDD04 CONTEXT - Resposta createRoom:",o),t({type:d.SET_ROOM_CODE,payload:o.roomCode}),t({type:d.SET_PLAYER_NICKNAME,payload:e}),t({type:d.SET_CONNECTED,payload:!0});let r=await (0,i.Nv)("/api/lobby?roomCode=".concat(o.roomCode));if(r.ok){let e=await r.json();t({type:d.SET_LOBBY_DATA,payload:e})}return o}{let e=await a.json();throw console.log("\uD83D\uDD04 CONTEXT - Erro createRoom:",e),t({type:d.SET_ERROR,payload:e.error||"Erro ao criar sala"}),Error(e.error)}}catch(e){throw console.log("\uD83D\uDD04 CONTEXT - Erro de conex\xe3o createRoom:",e),t({type:d.SET_ERROR,payload:"Erro de conex\xe3o"}),e}finally{t({type:d.SET_LOADING,payload:!1})}},joinRoom:async(e,a)=>{console.log("\uD83D\uDD04 CONTEXT - joinRoom chamado:",{roomCode:e,playerNickname:a}),t({type:d.SET_LOADING,payload:!0}),t({type:d.SET_ERROR,payload:""});try{let o={roomCode:e,nickname:a};console.log("\uD83D\uDD04 CONTEXT - Request body:",o),console.log("\uD83D\uDD04 CONTEXT - Request body JSON:",JSON.stringify(o));let r=await (0,i.Nv)("/api/lobby",{method:"PUT",body:JSON.stringify(o)});if(console.log("\uD83D\uDD04 CONTEXT - Response status:",r.status),console.log("\uD83D\uDD04 CONTEXT - Response ok:",r.ok),r.ok){let o=await r.json();return console.log("\uD83D\uDD04 CONTEXT - Response data:",o),t({type:d.SET_ROOM_CODE,payload:e}),t({type:d.SET_PLAYER_NICKNAME,payload:a}),t({type:d.SET_LOBBY_DATA,payload:o}),t({type:d.SET_CONNECTED,payload:!0}),o}{let e=await r.json();throw console.log("\uD83D\uDD04 CONTEXT - Error data:",e),t({type:d.SET_ERROR,payload:e.error||"Erro ao entrar na sala"}),Error(e.error)}}catch(e){throw console.log("\uD83D\uDD04 CONTEXT - Catch error:",e),t({type:d.SET_ERROR,payload:"Erro de conex\xe3o"}),e}finally{t({type:d.SET_LOADING,payload:!1})}},startGame:async()=>{if(o.roomCode){t({type:d.SET_LOADING,payload:!0}),t({type:d.SET_ERROR,payload:""});try{let e=await (0,i.Nv)("/api/lobby",{method:"PATCH",body:JSON.stringify({roomCode:o.roomCode,action:"start"})});if(e.ok){let a=await e.json();return t({type:d.SET_LOBBY_DATA,payload:a}),t({type:d.SET_CURRENT_SCREEN,payload:"game"}),a}{let a=await e.json();throw t({type:d.SET_ERROR,payload:a.error||"Erro ao iniciar jogo"}),Error(a.error)}}catch(e){throw t({type:d.SET_ERROR,payload:"Erro de conex\xe3o"}),e}finally{t({type:d.SET_LOADING,payload:!1})}}},makeGuess:async e=>{if(!o.roomCode||!o.playerNickname)return{success:!1,error:"Dados inv\xe1lidos"};try{let a=await (0,i.Nv)("/api/lobby",{method:"PATCH",body:JSON.stringify({roomCode:o.roomCode,action:"guess",nickname:o.playerNickname,guess:e})}),r=await a.json();if(a.ok)return r.lobbyData&&t({type:d.SET_LOBBY_DATA,payload:r.lobbyData}),{success:!0,correct:r.correct,gameCorrect:r.gameCorrect,winner:r.winner,attempts:r.attempts,tooLate:r.tooLate,message:r.message};return{success:!1,error:r.error}}catch(e){return{success:!1,error:"Erro de conex\xe3o"}}},nextRound:async()=>{if(!o.roomCode)return{success:!1,error:"Dados inv\xe1lidos"};try{let e=await (0,i.Nv)("/api/lobby",{method:"PATCH",body:JSON.stringify({roomCode:o.roomCode,action:"next_round",nickname:o.playerNickname})}),a=await e.json();if(e.ok)return a.lobbyData&&t({type:d.SET_LOBBY_DATA,payload:a.lobbyData}),{success:!0};return t({type:d.SET_ERROR,payload:a.error||"Erro ao avan\xe7ar rodada"}),{success:!1,error:a.error}}catch(e){return t({type:d.SET_ERROR,payload:"Erro de conex\xe3o"}),{success:!1,error:"Erro de conex\xe3o"}}},skipRound:async()=>{if(!o.roomCode||!o.playerNickname)return{success:!1,error:"Dados inv\xe1lidos"};try{let e=await (0,i.Nv)("/api/lobby",{method:"PATCH",body:JSON.stringify({roomCode:o.roomCode,action:"skip",nickname:o.playerNickname})}),a=await e.json();if(e.ok)return a.lobbyData&&t({type:d.SET_LOBBY_DATA,payload:a.lobbyData}),{success:!0};return t({type:d.SET_ERROR,payload:a.error||"Erro ao pular rodada"}),{success:!1,error:a.error}}catch(e){return t({type:d.SET_ERROR,payload:"Erro de conex\xe3o"}),{success:!1,error:"Erro de conex\xe3o"}}}}},children:a})}function g(){let e=(0,l.useContext)(m);if(!e)throw Error("useMultiplayerContext deve ser usado dentro de MultiplayerProvider");return e}var y=o(8569),E=o.n(y),h=e=>{var a,o,t;let{onGameStart:n}=e,{t:i,isClient:c}=(0,s.Z)(),{state:d,actions:u}=g(),{roomCode:m,playerNickname:p,lobbyData:y,isLoading:h,error:_}=d,[x,v]=(0,l.useState)({nickname:"",roomCode:""}),[C,D]=(0,l.useState)("menu");(0,l.useEffect)(()=>{y&&y.gameStarted&&"waiting"===C&&n()},[null==y?void 0:y.gameStarted,n,C]);let N=e=>{let{name:a,value:o}=e.target;v(e=>({...e,[a]:o}))},j=async e=>{if(e.preventDefault(),!x.nickname.trim()){u.setError(c?i("nickname_required"):"Nickname \xe9 obrigat\xf3rio"),setTimeout(()=>u.setError(""),3e3);return}try{await u.createRoom(x.nickname.trim()),D("waiting"),u.setError("")}catch(e){setTimeout(()=>u.setError(""),5e3)}},b=async e=>{if(e.preventDefault(),!x.nickname.trim()){u.setError(c?i("nickname_required"):"Nickname \xe9 obrigat\xf3rio"),setTimeout(()=>u.setError(""),3e3);return}if(!x.roomCode.trim()){u.setError(c?i("room_code_required"):"C\xf3digo da sala \xe9 obrigat\xf3rio"),setTimeout(()=>u.setError(""),3e3);return}try{await u.joinRoom(x.roomCode.trim().toUpperCase(),x.nickname.trim()),D("waiting"),u.setError("")}catch(e){setTimeout(()=>u.setError(""),5e3)}},f=async()=>{if(console.log("\uD83C\uDFAE LOBBY - handleStartGame chamado"),h){console.log("\uD83C\uDFAE LOBBY - J\xe1 est\xe1 carregando, saindo...");return}console.log("\uD83C\uDFAE LOBBY - Chamando startGame...");try{await u.startGame(),console.log("\uD83C\uDFAE LOBBY - Sucesso! Chamando onGameStart..."),n(),console.log("\uD83C\uDFAE LOBBY - onGameStart chamado")}catch(e){console.log("\uD83C\uDFAE LOBBY - Erro:",e)}},T=async()=>{u.reset(),D("menu"),v({nickname:"",roomCode:""})},S=(null==y?void 0:y.host)===p,R=((null==y?void 0:null===(a=y.players)||void 0===a?void 0:a.length)||0)>=2;return"menu"===C?(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().lobbyContainer,children:[(0,r.jsx)("h1",{className:E().title,children:c?i("multiplayer"):"Multiplayer"}),(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{className:E().primaryButton,onClick:()=>D("create"),disabled:h,children:c?i("create_room"):"Criar Sala"}),(0,r.jsx)("button",{className:E().secondaryButton,onClick:()=>D("join"),disabled:h,children:c?i("join_room"):"Entrar na Sala"})]}),_&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageError),children:_})]})})}):"create"===C?(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().lobbyContainer,children:[(0,r.jsx)("h1",{className:E().title,children:c?i("create_room"):"Criar Sala"}),(0,r.jsxs)("form",{onSubmit:j,className:E().form,children:[(0,r.jsxs)("div",{className:E().inputGroup,children:[(0,r.jsx)("label",{className:E().label,children:c?i("nickname"):"Nickname"}),(0,r.jsx)("input",{type:"text",name:"nickname",value:x.nickname,onChange:N,placeholder:c?i("nickname"):"Seu nickname",className:E().input,maxLength:20,required:!0})]}),(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{type:"button",className:E().secondaryButton,onClick:()=>D("menu"),disabled:h,children:"Voltar"}),(0,r.jsx)("button",{type:"submit",className:E().primaryButton,disabled:h||!x.nickname.trim(),children:h?c?i("creating_room"):"Criando sala...":c?i("create_room"):"Criar Sala"})]})]}),_&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageError),children:_})]})})}):"join"===C?(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().lobbyContainer,children:[(0,r.jsx)("h1",{className:E().title,children:c?i("join_room"):"Entrar na Sala"}),(0,r.jsxs)("form",{onSubmit:b,className:E().form,children:[(0,r.jsxs)("div",{className:E().inputGroup,children:[(0,r.jsx)("label",{className:E().label,children:c?i("nickname"):"Nickname"}),(0,r.jsx)("input",{type:"text",name:"nickname",value:x.nickname,onChange:N,placeholder:c?i("nickname"):"Seu nickname",className:E().input,maxLength:20,required:!0})]}),(0,r.jsxs)("div",{className:E().inputGroup,children:[(0,r.jsx)("label",{className:E().label,children:c?i("room_code"):"C\xf3digo da Sala"}),(0,r.jsx)("input",{type:"text",name:"roomCode",value:x.roomCode,onChange:N,placeholder:"ABC123",className:E().input,maxLength:6,style:{textTransform:"uppercase"},required:!0})]}),(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{type:"button",className:E().secondaryButton,onClick:()=>D("menu"),disabled:h,children:"Voltar"}),(0,r.jsx)("button",{type:"submit",className:E().primaryButton,disabled:h||!x.nickname.trim()||!x.roomCode.trim(),children:h?c?i("joining_room"):"Entrando na sala...":c?i("join_room"):"Entrar na Sala"})]})]}),_&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageError),children:_})]})})}):"waiting"===C&&y?(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().waitingRoom,children:[(0,r.jsx)("h1",{className:E().title,children:c?i("waiting_for_players"):"Aguardando Jogadores"}),(0,r.jsx)("div",{className:E().roomCode,children:m}),(0,r.jsx)("p",{children:"Compartilhe este c\xf3digo com outros jogadores"}),(0,r.jsxs)("div",{className:E().playersList,children:[(0,r.jsxs)("h3",{className:E().playersTitle,children:[c?i("players_in_room"):"Jogadores na sala"," (",(null==y?void 0:null===(o=y.players)||void 0===o?void 0:o.length)||0,")"]}),(null==y?void 0:null===(t=y.players)||void 0===t?void 0:t.map((e,a)=>(0,r.jsxs)("div",{className:E().playerItem,children:[(0,r.jsx)("span",{className:E().playerName,children:e}),e===y.host&&(0,r.jsx)("span",{className:E().hostBadge,children:"ANFITRI\xc3O"})]},a)))||[]]}),S?(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{className:E().secondaryButton,onClick:T,disabled:h,children:c?i("leave_room"):"Sair da Sala"}),(0,r.jsx)("button",{className:E().primaryButton,onClick:f,disabled:h||!R,children:c?i("start_game"):"Iniciar Jogo"})]}):(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{className:E().secondaryButton,onClick:T,disabled:h,children:c?i("leave_room"):"Sair da Sala"}),(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageInfo),children:c?i("waiting_for_host"):"Aguardando anfitri\xe3o iniciar o jogo..."})]}),!R&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageWarning),children:c?i("minimum_players"):"M\xednimo 2 jogadores para iniciar"}),_&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageError),children:_})]})})}):(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().loading,children:[(0,r.jsx)("div",{className:E().spinner}),c?i("loading"):"Carregando..."]})})})},_=o(6507),x=o(9647),v=o.n(x),C=o(2091),D=e=>{var a,o,t,n,i,c;let{onBackToLobby:d}=e;console.log("\uD83C\uDFAE JOGO - MultiplayerGame renderizado");let{t:u,isClient:m}=(0,s.Z)(),{state:p,actions:y}=g(),{playerNickname:h,lobbyData:x,error:D}=p;console.log("\uD83C\uDFAE JOGO - lobbyData:",x),console.log("\uD83C\uDFAE JOGO - gameStarted:",null==x?void 0:x.gameStarted);let[N,j]=(0,l.useState)(""),[b,f]=(0,l.useState)(!1),[T,S]=(0,l.useState)([]),[R,A]=(0,l.useState)(!1),[O,k]=(0,l.useState)(0),[B,M]=(0,l.useState)(1),[L,w]=(0,l.useState)(!1),[F,G]=(0,l.useState)(0),I=(0,l.useRef)(null),P=(0,l.useRef)(null),Y=null==x?void 0:x.gameState,U=null==x?void 0:x.currentSong,J=(null==x?void 0:x.host)===h,z=(null==Y?void 0:Y.roundWinners)||[],V=(null==Y?void 0:Y.roundFinished)||!1,X=null==Y?void 0:Y.gameFinished,q=(null==Y?void 0:null===(a=Y.attempts)||void 0===a?void 0:a[h])||0;console.log("\uD83D\uDD0D DEBUG - Estado da rodada:",{roundFinished:V,isHost:J,roundWinners:z,myAttempts:q,gameState:Y?"exists":"null"});let H=[.6,1.2,2,3,3.5,4.2],W=z.includes(h),Z=U;if(!Z&&(null==Y?void 0:Y.songs)&&Y.songs.length>0){let e=(Y.currentRound||1)-1;Z=Y.songs[e]}!Z&&(null==Y?void 0:Y.currentSong)&&(Z=_.x.find(e=>e.title.trim().toLowerCase()===Y.currentSong.trim().toLowerCase()));let K=(e,a)=>31*a%997/997*Math.max(0,e-10);(0,l.useEffect)(()=>{let e=U;if(!e&&(null==Y?void 0:Y.songs)&&Y.songs.length>0){let a=(Y.currentRound||1)-1;e=Y.songs[a]}if(!e&&(null==Y?void 0:Y.currentSong)&&(e=_.x.find(e=>e.title.trim().toLowerCase()===Y.currentSong.trim().toLowerCase())),console.log("\uD83C\uDFB5 AUDIO - Configurando \xe1udio para:",null==e?void 0:e.title),e&&I.current){let a=()=>{let a=K(I.current.duration||0,e.id);G(a),I.current.currentTime=a,k(0),console.log("\uD83C\uDFB5 AUDIO - Metadata carregada, startTime:",a)},o=()=>{console.error("\uD83C\uDFB5 AUDIO - Erro ao carregar \xe1udio:",e.audioUrl)};return I.current.addEventListener("loadedmetadata",a),I.current.addEventListener("error",o),()=>{I.current&&(I.current.removeEventListener("loadedmetadata",a),I.current.removeEventListener("error",o))}}},[U,null==Y?void 0:Y.songs,null==Y?void 0:Y.currentRound,null==Y?void 0:Y.currentSong]),(0,l.useEffect)(()=>{let e=I.current;if(!e)return;let a=W?15:H[q]||H[H.length-1],o=()=>{let o=e.currentTime-F;o>=15?(e.pause(),A(!1),e.currentTime=F,k(0)):!W&&o>=a?(e.pause(),A(!1),e.currentTime=F,k(0)):k(o)},r=()=>{A(!e.paused)};return e.addEventListener("timeupdate",o),e.addEventListener("play",r),e.addEventListener("pause",r),()=>{e.removeEventListener("timeupdate",o),e.removeEventListener("play",r),e.removeEventListener("pause",r)}},[F,q,W]),(0,l.useEffect)(()=>{console.log("\uD83C\uDFB5 ROUND CHANGE - Rodada mudou:",null==Y?void 0:Y.currentRound),I.current&&(I.current.pause(),A(!1),k(0),void 0!==F&&(I.current.currentTime=F),console.log("\uD83C\uDFB5 ROUND CHANGE - Estado do \xe1udio resetado")),j(""),f(!1),S([]),w(!1),console.log("\uD83C\uDFAE ROUND CHANGE - Interface resetada")},[null==Y?void 0:Y.currentRound,F]),(0,l.useEffect)(()=>{I.current&&(null==Z?void 0:Z.audioUrl)&&(console.log("\uD83C\uDFB5 AUDIO URL - Nova URL de \xe1udio:",Z.audioUrl),I.current.pause(),A(!1),k(0),I.current.load())},[null==Z?void 0:Z.audioUrl]);let Q=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,""),$=(e,a)=>{let o=Q(e.title),r=Q(e.game),t=Q(e.artist),n=Q(a);return o.includes(n)?1:r.includes(n)?2:t.includes(n)?3:4},ee=e=>{if(e.length>0){let a=e.trim().split(/\s+/).filter(e=>e.length>0).map(e=>Q(e)).filter(e=>e.length>1);if(0===a.length)return S([]),f(!1),[];let o=_.x.filter(e=>{let o=Q(e.title),r=Q(e.game),t=Q(e.artist);return a.some(e=>o.includes(e)||r.includes(e)||t.includes(e))}).sort((a,o)=>{let r=$(a,e),t=$(o,e);if(r!==t)return r-t;let n=Q(a.game).localeCompare(Q(o.game));return 0!==n?n:Q(a.title).localeCompare(Q(o.title))}).slice(0,50);S(o),f(o.length>0)}else S([]),f(!1);return[]},ea=e=>{j(e.title),f(!1)},eo=async e=>{if(e.preventDefault(),V||!N.trim()){w(!0),setTimeout(()=>w(!1),500);return}let a=Q(N);if(!_.x.some(e=>Q(e.title)===a)){y.setError(m?u("select_from_list"):"Selecione uma m\xfasica da lista"),w(!0),setTimeout(()=>w(!1),500),setTimeout(()=>y.setError(""),3e3);return}console.log("\uD83C\uDFAE GAME - Fazendo tentativa:",N);let o=await y.makeGuess(N.trim());o.success?(console.log("\uD83C\uDFAE GAME - Tentativa enviada com sucesso:",o),j(""),f(!1),o.correct?o.tooLate?(console.log("\uD83C\uDFAE GAME - Acertou, mas chegou tarde!"),y.setError(o.message||"Algu\xe9m j\xe1 havia acertado primeiro!"),setTimeout(()=>y.setError(""),4e3)):(console.log("\uD83C\uDFAE GAME - Acertou a m\xfasica!"),y.setError("")):o.gameCorrect&&(console.log("\uD83C\uDFAE GAME - Acertou o jogo mas n\xe3o a m\xfasica!"),y.setError("Jogo correto! Tente adivinhar a m\xfasica espec\xedfica."),setTimeout(()=>y.setError(""),3e3))):(console.log("\uD83C\uDFAE GAME - Tentativa n\xe3o aceita:",o.error),w(!0),setTimeout(()=>w(!1),500))},er=async()=>{console.log("\uD83C\uDFAE GAME - Avan\xe7ando para pr\xf3xima rodada");let e=await y.nextRound();e.success?console.log("\uD83C\uDFAE GAME - Pr\xf3xima rodada iniciada"):console.log("\uD83C\uDFAE GAME - Erro ao avan\xe7ar rodada:",e.error)},et=async()=>{console.log("\uD83C\uDFAE GAME - Pulando rodada");let e=await y.skipRound();e.success?console.log("\uD83C\uDFAE GAME - Rodada pulada"):console.log("\uD83C\uDFAE GAME - Erro ao pular rodada:",e.error)},en=(e,a)=>{if(!e||0===a)return null;if(1===a){if(I.current&&I.current.duration){let e=I.current.duration,a="".concat((Math.floor(e/60)||0).toString().padStart(2,"0"),":").concat((Math.floor(e%60)||0).toString().padStart(2,"0"));return"Dura\xe7\xe3o: ".concat(a)}return"Dura\xe7\xe3o: ~3:00"}return 2===a?"Ano de lan\xe7amento: ".concat(e.year):3===a?"Artista: ".concat(e.artist):4===a?"Console: ".concat(e.console||"Desconhecido"):a>=5?"Franquia: ".concat(e.game):null},es=async()=>{y.reset(),d()},el=async()=>{console.log("\uD83C\uDFAE GAME - Reset do jogo"),d()},ei=(null==Y?void 0:Y.scores)?Object.entries(Y.scores).map(e=>{let[a,o]=e;return{player:a,score:o}}).sort((e,a)=>a.score-e.score):[],ec=ei.length>0?ei[0].score:0,ed=ei.filter(e=>e.score===ec);return(console.log("\uD83C\uDFAE GAME - Verificando condi\xe7\xf5es:",{lobbyData:!!x,gameStarted:null==x?void 0:x.gameStarted,gameState:!!Y}),x&&x.gameStarted&&Y)?(console.log("\uD83C\uDFAE GAME - Condi\xe7\xf5es atendidas, renderizando jogo"),(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().gameContainer,children:[(0,r.jsxs)("div",{className:E().gameHeader,children:[(0,r.jsx)("div",{className:E().roundInfo,children:X?m?u("game_finished"):"Jogo Finalizado!":Y.isTiebreaker?m?u("tiebreaker_round"):"Rodada de Desempate":"".concat(m?u("round"):"Rodada"," ").concat(Y.currentRound,"/").concat(Y.totalRounds)}),(0,r.jsx)("div",{className:E().scoreBoard,children:Object.entries(Y.scores||{}).map(e=>{let[a,o]=e;return(0,r.jsxs)("div",{className:"".concat(E().scoreItem," ").concat(a===h?E().currentPlayer:""),children:[a,": ",o]},a)})})]}),en(Z,q)&&!X&&!V&&(0,r.jsxs)("div",{className:E().hintBox,children:[(0,r.jsx)("strong",{children:"Dica:"})," ",en(Z,q)]}),X?(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("h2",{children:m?u("final_scores"):"Pontua\xe7\xe3o Final"}),(0,r.jsxs)("div",{className:E().pointsExplanation,children:[(0,r.jsx)("p",{children:"Sistema de Pontua\xe7\xe3o:"}),(0,r.jsx)("p",{children:"6 pontos (sem dicas) • 5 pontos (1 dica) • 4 pontos (2 dicas) • 3 pontos (3 dicas) • 2 pontos (4 dicas) • 1 ponto (5 dicas)"})]}),(0,r.jsx)("div",{style:{margin:"30px 0"},children:ei.map((e,a)=>(0,r.jsxs)("div",{className:E().scoreItem,style:{margin:"10px auto",maxWidth:"300px",fontSize:0===a?"1.2rem":"1rem",fontWeight:0===a?"bold":"normal"},children:["#",a+1," ",e.player,": ",e.score," pontos"]},e.player))}),(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageSuccess),children:1===ed.length?"".concat(m?u("winner"):"Vencedor",": ").concat(ed[0].player,"!"):"".concat(m?u("tie"):"Empate","! ").concat(ed.map(e=>e.player).join(", "))}),(0,r.jsxs)("div",{className:E().buttonGroup,children:[(0,r.jsx)("button",{className:E().secondaryButton,onClick:es,children:m?u("back_to_lobby"):"Voltar ao Lobby"}),J&&(0,r.jsx)("button",{className:E().primaryButton,onClick:el,children:m?u("play_again"):"Jogar Novamente"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:v().audioModernBox,children:(0,r.jsxs)("div",{className:v().customAudioPlayer,children:[(0,r.jsxs)("div",{className:v().audioPlayerRow,children:[(0,r.jsx)("span",{className:v().audioTime,children:new Date(1e3*O).toISOString().substring(14,19)}),(0,r.jsx)("input",{type:"range",min:0,max:Math.min(15,W?15:H[q]||H[H.length-1]),step:.01,value:O,onChange:e=>{if(I.current&&R){let a=Math.min(Number(e.target.value),15);I.current.currentTime=F+a,k(a)}},className:v().audioSeekbarCustom,disabled:!Z}),(0,r.jsx)("span",{className:v().audioTime,children:new Date(1e3*Math.min(15,W?15:H[q]||H[H.length-1])).toISOString().substring(14,19)})]}),(0,r.jsxs)("div",{className:v().audioVolumeRow,children:[(0,r.jsx)("button",{className:v().audioPlayBtnCustom,onClick:()=>{if(!I.current){console.log("\uD83C\uDFB5 PLAY - \xc1udio ref n\xe3o dispon\xedvel");return}console.log("\uD83C\uDFB5 PLAY - Tentando play/pause, isPlaying:",R);let e=I.current.currentTime-F,a=W?15:H[q]||H[H.length-1];(e>=15||!W&&e>=a)&&(I.current.currentTime=F,k(0),console.log("\uD83C\uDFB5 PLAY - Resetando para o in\xedcio devido ao tempo limite")),R?(I.current.pause(),console.log("\uD83C\uDFB5 PLAY - Pausando \xe1udio")):((I.current.currentTime<F||I.current.currentTime>F+a)&&(I.current.currentTime=F,k(0),console.log("\uD83C\uDFB5 PLAY - Ajustando posi\xe7\xe3o antes de tocar")),I.current.play().then(()=>{console.log("\uD83C\uDFB5 PLAY - \xc1udio iniciado com sucesso")}).catch(e=>{console.error("\uD83C\uDFB5 PLAY - Erro ao iniciar \xe1udio:",e)}))},disabled:!Z,children:R?(0,r.jsx)(C.Wh,{color:"#fff",size:20}):(0,r.jsx)(C.gmG,{color:"#fff",size:20})}),(0,r.jsx)(C.rxG,{color:"#fff",style:{marginRight:8}}),(0,r.jsx)("input",{type:"range",min:0,max:1,step:.01,value:B,onChange:e=>{M(Number(e.target.value)),I.current&&(I.current.volume=Number(e.target.value))},className:v().audioVolumeCustom})]}),(0,r.jsx)("audio",{ref:I,src:null==Z?void 0:Z.audioUrl,style:{display:"none"},onError:()=>y.setError("Erro ao carregar \xe1udio")})]})}),(0,r.jsx)("div",{className:v().pointsInfo,children:(0,r.jsxs)("span",{className:v().pointsText,children:[0===q?"6 pontos":1===q?"5 pontos":2===q?"4 pontos":3===q?"3 pontos":4===q?"2 pontos":5===q?"1 ponto":"0 pontos",q<6&&" se acertar agora"]})}),(0,r.jsxs)("div",{className:v().attemptsRow,children:[[...Array(6)].map((e,a)=>{var o,t,n;let s=v().attemptInactive;if(0===a&&console.log("\uD83C\uDFA8 DEBUG - Estado das tentativas:",{nickname:h,myAttempts:q,guesses:null==Y?void 0:null===(t=Y.guesses)||void 0===t?void 0:t[h],roundWinners:z}),a<q){let e=((null==Y?void 0:null===(n=Y.guesses)||void 0===n?void 0:n[h])||[])[a];console.log("\uD83C\uDFA8 COLOR - Tentativa",a+1,":",e),e?e.correct&&!e.tooLate?(s=v().attemptSuccess,console.log("\uD83C\uDFA8 COLOR - Verde (acertou)")):e.gameCorrect&&!e.correct?(s=v().attemptGame,console.log("\uD83C\uDFA8 COLOR - Amarelo (jogo correto)")):"skipped"===e.type?(s=v().attemptFail,console.log("\uD83C\uDFA8 COLOR - Vermelho (skip)")):(s=v().attemptFail,console.log("\uD83C\uDFA8 COLOR - Vermelho (erro/tarde)")):W&&a===q-1?(s=v().attemptSuccess,console.log("\uD83C\uDFA8 COLOR - Verde (fallback - vencedor)")):(s=v().attemptFail,console.log("\uD83C\uDFA8 COLOR - Vermelho (fallback)"))}let l=((null==Y?void 0:null===(o=Y.guesses)||void 0===o?void 0:o[h])||[])[a],i=l?"skipped"===l.type?"Pulou":l.guess:"";return(0,r.jsx)("button",{type:"button",className:"".concat(v().attemptButton," ").concat(s),disabled:!0,title:i,style:{cursor:i?"help":"default"},children:a+1},a)}),(0,r.jsxs)("button",{type:"button",className:"".concat(v().attemptButton," ").concat(v().attemptInactive),onClick:et,disabled:V||q>=6||W,style:{marginLeft:"10px"},children:[m?u("skip"):"Pular"," ",(0,r.jsx)(C.uE0,{style:{marginLeft:4,fontSize:"1em",verticalAlign:"middle"}})]})]}),V||W?W&&!V?(0,r.jsxs)("div",{className:"".concat(E().message," ").concat(E().messageSuccess),children:[(0,r.jsx)("div",{style:{fontSize:"1.2rem",marginBottom:"10px"},children:"\uD83C\uDF89 Parab\xe9ns! Voc\xea acertou!"}),(0,r.jsx)("div",{style:{fontSize:"1rem",marginBottom:"15px"},children:(0,r.jsxs)("strong",{children:[null==Z?void 0:Z.game," - ",null==Z?void 0:Z.title]})}),(0,r.jsxs)("div",{className:E().pointsEarned,children:["+",Math.max(0,6-q+1)," pontos!"]}),(0,r.jsx)("div",{style:{marginTop:"15px",fontSize:"0.9rem",opacity:.8},children:"Aguardando outros jogadores terminarem suas tentativas..."}),(0,r.jsxs)("div",{style:{marginTop:"20px",fontSize:"0.85rem"},children:[(0,r.jsx)("div",{style:{marginBottom:"10px",fontWeight:"bold",color:"#4ecdc4"},children:"Suas tentativas:"}),(0,r.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",padding:"10px",maxHeight:"120px",overflowY:"auto"},children:(null==Y?void 0:null===(t=Y.guesses)||void 0===t?void 0:null===(o=t[h])||void 0===o?void 0:o.length)>0?Y.guesses[h].map((e,a)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px",padding:"4px 8px",borderRadius:"4px",background:e.correct?"rgba(76, 175, 80, 0.2)":e.gameCorrect?"rgba(255, 193, 7, 0.2)":"skipped"===e.type?"rgba(158, 158, 158, 0.2)":"rgba(244, 67, 54, 0.2)",border:"1px solid ".concat(e.correct?"rgba(76, 175, 80, 0.4)":e.gameCorrect?"rgba(255, 193, 7, 0.4)":"skipped"===e.type?"rgba(158, 158, 158, 0.4)":"rgba(244, 67, 54, 0.4)")},children:[(0,r.jsx)("span",{style:{color:e.correct?"#4caf50":e.gameCorrect?"#ffc107":"skipped"===e.type?"#9e9e9e":"#f44336"},children:"skipped"===e.type?"⏭️ Pulou":e.guess}),(0,r.jsx)("span",{style:{fontSize:"0.75rem",opacity:.8},children:e.correct?"✅":e.gameCorrect?"\uD83C\uDFAE":"skipped"===e.type?"⏭️":"❌"})]},a)):(0,r.jsx)("div",{style:{textAlign:"center",opacity:.6},children:"Nenhuma tentativa ainda"})})]}),(0,r.jsxs)("div",{style:{marginTop:"15px",fontSize:"0.8rem",opacity:.7},children:[(0,r.jsx)("div",{style:{marginBottom:"5px"},children:"Status dos jogadores:"}),null==x?void 0:null===(n=x.players)||void 0===n?void 0:n.map(e=>{var a;let o=(null==Y?void 0:null===(a=Y.attempts)||void 0===a?void 0:a[e])||0,t=z.includes(e),n=t||o>=6;return(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px",color:t?"#4caf50":n?"#ff9800":"#ccc"},children:[(0,r.jsxs)("span",{children:[e,":"]}),(0,r.jsx)("span",{children:t?"✅ Acertou":n?"❌ Terminou":"".concat(o,"/6 tentativas")})]},e)})]})]}):(0,r.jsxs)("div",{className:"".concat(E().message," ").concat(z.includes("NONE")?E().messageWarning:E().messageSuccess),children:[z.includes("NONE")?m?u("no_one_guessed"):"Ningu\xe9m acertou a m\xfasica!":1===z.length?z[0]===h?m?u("congratulations"):"Parab\xe9ns! Voc\xea acertou!":"".concat(z[0]," ").concat(m?u("player_guessed_correctly"):"acertou a m\xfasica!"):z.length===x.players.length?"Todos acertaram!":"".concat(z.length," jogadores acertaram: ").concat(z.join(", ")),(0,r.jsx)("br",{}),(0,r.jsxs)("strong",{children:[null==Z?void 0:Z.game," - ",null==Z?void 0:Z.title]}),W&&(0,r.jsxs)("div",{className:E().pointsEarned,children:["+",Math.max(0,6-q+1)," pontos!"]}),(null==Y?void 0:null===(c=Y.guesses)||void 0===c?void 0:null===(i=c[h])||void 0===i?void 0:i.length)>0&&(0,r.jsxs)("div",{style:{marginTop:"20px",fontSize:"0.85rem"},children:[(0,r.jsx)("div",{style:{marginBottom:"10px",fontWeight:"bold",color:"#4ecdc4"},children:"Suas tentativas nesta rodada:"}),(0,r.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",padding:"10px",maxHeight:"100px",overflowY:"auto"},children:Y.guesses[h].map((e,a)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px",padding:"3px 6px",borderRadius:"3px",background:e.correct?"rgba(76, 175, 80, 0.2)":e.gameCorrect?"rgba(255, 193, 7, 0.2)":"skipped"===e.type?"rgba(158, 158, 158, 0.2)":"rgba(244, 67, 54, 0.2)",fontSize:"0.8rem"},children:[(0,r.jsxs)("span",{style:{color:e.correct?"#4caf50":e.gameCorrect?"#ffc107":"skipped"===e.type?"#9e9e9e":"#f44336"},children:[a+1,". ","skipped"===e.type?"Pulou":e.guess]}),(0,r.jsx)("span",{style:{fontSize:"0.7rem"},children:e.correct?"✅":e.gameCorrect?"\uD83C\uDFAE":"skipped"===e.type?"⏭️":"❌"})]},a))})]})]}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("form",{onSubmit:eo,className:v().guessFormModern,autoComplete:"off",children:[(0,r.jsx)("input",{ref:P,type:"text",value:N,onChange:e=>{let a=e.target.value;j(a),ee(a)},onFocus:()=>{N.trim()?ee(N):(S(_.x.slice(0,10)),f(!0))},placeholder:m?u("song_input_placeholder"):"Digite o nome da m\xfasica...",disabled:q>=6,className:v().guessInputModern,onBlur:()=>setTimeout(()=>f(!1),200)}),(0,r.jsx)("button",{type:"submit",disabled:q>=6||!N.trim(),className:"".concat(v().guessButtonModern," ").concat(L?v().shake:""),children:m?u("guess"):"Adivinhar"}),b&&T.length>0&&(0,r.jsx)("ul",{className:v().suggestionsListModern,children:T.map(e=>(0,r.jsxs)("li",{className:v().suggestionItemModern,onMouseDown:()=>ea(e),children:[e.game," - ",e.title]},e.id))})]})}),V&&J&&(0,r.jsx)("div",{style:{textAlign:"center",marginTop:"20px"},children:(0,r.jsx)("button",{className:E().primaryButton,onClick:er,children:m?u("next_round"):"Pr\xf3xima Rodada"})}),V&&!J&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageInfo),children:"Aguardando anfitri\xe3o avan\xe7ar para a pr\xf3xima rodada..."}),q>=6&&!V&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageWarning),children:"Voc\xea esgotou suas tentativas para esta rodada. Aguardando outros jogadores..."})]}),D&&(0,r.jsx)("div",{className:"".concat(E().message," ").concat(E().messageError),children:D})]})})})):(console.log("\uD83C\uDFAE GAME - Mostrando tela de loading"),(0,r.jsx)("div",{className:E().container,children:(0,r.jsx)("div",{className:E().content,children:(0,r.jsxs)("div",{className:E().loading,children:[(0,r.jsx)("div",{className:E().spinner}),m?u("loading"):"Carregando..."]})})}))},N=o(238);function j(){let{t:e,isClient:a}=(0,s.Z)(),{state:o,actions:t}=g();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:a?"".concat(e("multiplayer")," - Bandle"):"Multiplayer - Bandle"}),(0,r.jsx)("meta",{name:"description",content:a?"Jogue Bandle com seus amigos! Adivinhe m\xfasicas de videogames em modo multiplayer.":"Play Bandle with your friends! Guess video game music in multiplayer mode."}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[(0,r.jsx)("div",{style:{flex:1},children:"lobby"===o.currentScreen?(0,r.jsx)(h,{onGameStart:()=>{console.log("\uD83C\uDFAE MULTIPLAYER - handleGameStart chamado, mudando estado para game"),t.setCurrentScreen("game"),console.log("\uD83C\uDFAE MULTIPLAYER - Estado mudado para game")}}):(0,r.jsx)(D,{onBackToLobby:()=>{console.log("\uD83C\uDFAE MULTIPLAYER - handleBackToLobby chamado"),t.setCurrentScreen("lobby")}})}),(0,r.jsx)(N.Z,{})]})]})}function b(){return(0,r.jsx)(p,{children:(0,r.jsx)(j,{})})}},8569:function(e){e.exports={container:"Multiplayer_container__pG5zq",content:"Multiplayer_content__paqrY",lobbyContainer:"Multiplayer_lobbyContainer__mFUxx",title:"Multiplayer_title__c2wel",buttonGroup:"Multiplayer_buttonGroup__MtTI1",primaryButton:"Multiplayer_primaryButton__5Qr0G",secondaryButton:"Multiplayer_secondaryButton__fOHZA",form:"Multiplayer_form__NEyLG",inputGroup:"Multiplayer_inputGroup__xUkyP",label:"Multiplayer_label__JdhkF",input:"Multiplayer_input__d_6vv",waitingRoom:"Multiplayer_waitingRoom__TnsCI",roomCode:"Multiplayer_roomCode__xMu8X",playersList:"Multiplayer_playersList__JTt5d",playersTitle:"Multiplayer_playersTitle__GDwhB",playerItem:"Multiplayer_playerItem__ueGdP",playerName:"Multiplayer_playerName__98Zrf",hostBadge:"Multiplayer_hostBadge__XJkEC",gameContainer:"Multiplayer_gameContainer__BNvB0",gameHeader:"Multiplayer_gameHeader__zIa0f",roundInfo:"Multiplayer_roundInfo__29inF",scoreBoard:"Multiplayer_scoreBoard__RE7qE",scoreItem:"Multiplayer_scoreItem__LDz9_",currentPlayer:"Multiplayer_currentPlayer__Bc1B2",pointsInfo:"Multiplayer_pointsInfo___JMag",pointsText:"Multiplayer_pointsText__wVJq1",pointsExplanation:"Multiplayer_pointsExplanation__pVq8O",pointsEarned:"Multiplayer_pointsEarned__8c11S",hintBox:"Multiplayer_hintBox__Gctzd",message:"Multiplayer_message__O7bg0",messageSuccess:"Multiplayer_messageSuccess__X0lOU",messageError:"Multiplayer_messageError__Dhxdu",messageInfo:"Multiplayer_messageInfo__86_jG",messageWarning:"Multiplayer_messageWarning__ei_9w",loading:"Multiplayer_loading__U_sZC",spinner:"Multiplayer_spinner__kPnfW",spin:"Multiplayer_spin__sGivk"}},9008:function(e,a,o){e.exports=o(6665)}},function(e){e.O(0,[365,603,234,888,774,179],function(){return e(e.s=5022)}),_N_E=e.O()}]);